
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>SAP Support Chat - Test Form</title>

  <style>
    /* Style inputs, select elements and textareas */

    input[type=text],
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      resize: vertical;
    }

    /* Style the label to display next to the inputs */

    label {
      padding: 12px 12px 12px 0;
      display: inline-block;
    }

    /* Style the submit button */

    #submit_button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 22px;
      transform: translate(-50%);
      margin-left: 50%;
    }

    #submit_button:disabled {
      background-color: grey;
      cursor: auto;
    }

    /* Style the container */

    .container {
      border-radius: 5px;
      background-color: #f2f2f2;
      padding: 20px;
    }

    /* Floating column for labels */

    .col-25 {
      float: left;
      width: 25%;
      margin-top: 6px;
    }

    .col-75 {
      float: left;
      width: 75%;
      margin-top: 6px;
    }

    /* Clear floats after the columns */

    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    @media screen and (max-width: 600px) {
      .col-25,
      .col-75,
      input[type=submit] {
        width: 100%;
        margin-top: 0;
      }
    }

    #success_box {
      background: #E2F1BB;
      border: 1px solid #598800;
      border-radius: 5px;
      color: #000000;
      display: none;
      font-size: 13px;
      margin: 0px 0px 15px 0px;
      padding: 8px 8px;
      width: 50%;
    }

    #error_box {
      background: #FAD3C4;
      border: 1px solid #A75B4E;
      border-radius: 5px;
      color: #444444;
      display: none;
      font-size: 13px;
      margin: 0px 0px 15px 0px;
      padding: 8px 8px;
      width: 50%;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha512.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/validate-js/2.0.1/validate.min.js"></script>
</head>

<body>
  <div class="container">
    <div id="success_box">All of the fields were successfully validated, starting chat</div>
    <div id="error_box"></div>
    <h1>SAP Support Chat - Test Form</h1>
    <form name="SAPFORM" action="#" id="SAPFORM" method="post">
      <h2>Bold360 Attributes</h2>
      
      <div class="row">
        <div class="col-25">
          <label for="department">Department* [rdid]</label>
        </div>
        <div class="col-75">
          <select id="department" name="department">
          </select>
        </div>
      </div>

      <p/>

      <div class="row">
        <div class="col-25">
          <label for="fname">Name* [vn]</label>
        </div>
        <div class="col-75">
          <input type="text" id="fname" name="fname" placeholder="Enter YOUR full name here please" value="Elisabeth Prokesch"> 
        </div>
      </div>

  
      <div class="row">
        <div class="col-25">
          <label for="lname">Last Name [ln]</label>
        </div>
        <div class="col-75">
          <input type="text" id="lname" name="lname" placeholder="Last name" value="Prokesch"> </div>
      </div>


      <div class="row">
        <div class="col-25">
          <label for="phone">Phone* [vp]</label>
        </div>
        <div class="col-75">
          <input type="text" id="phone" name="phone" placeholder="Phone" value="006646207483"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="email">Email* [ve]</label>
        </div>
        <div class="col-75">
          <input type="text" id="email" name="email" placeholder="YOUR Email address" value="elisabeth.prokesch@sap.com" >
        </div>
      </div>

      <p/>

      <div class="row">
        <div class="col-25">
          <label for="question">Question [iq]</label>
        </div>
        <div class="col-75">
          <textarea id="question" name="question" placeholder="Question" style="height:100px">
Hello SAP, 
Here is my question ... with long text, long

Thanks,
Sissi
          </textarea>
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="info">Info [vi]</label>
        </div>
        <div class="col-75">
          <input type="text" id="info" name="info" placeholder="Info" value="Below is my incident id">
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="ref">Reference [vr]</label>
        </div>
        <div class="col-75">
          <input type="text" id="ref" name="ref" placeholder="External Reference" value="002075125200003242562018">
        </div>
      </div>


      <div class="row">
        <div class="col-25">
          <label for="lang">Language [lc]</label>
        </div>
        <div class="col-75">
          <input type="text" id="lang" name="lang" placeholder="Language Code" value="en-US">
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="url">URL [url]</label>
        </div>
        <div class="col-75">
          <input type="text" id="url" name="url" placeholder="URL" value="https://launchpad.support.sap.com/">
        </div>
      </div>


      <h2>Custom Attributes</h2>

      <h3>Categorization Data</h3>
      <div class="row">
        <div class="col-25">
          <label for="busunit">Business Unit* [_busunit]</label>
        </div>
        <div class="col-75">
          <input type="text" id="busunit" name="busunit" placeholder="Business Unit, either CIC or PS" value="CIC" > </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="subject">Subject [_subject]</label>
        </div>
        <div class="col-75">
          <input type="text" id="subject" name="subject" placeholder="Subject" value="I have an issue with SAP One Support Launchpad"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="comp_id">Component Id [_comp_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="comp_id" name="comp_id" placeholder="Component Id" value="0000039254"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="comp">Component [_comp]</label>
        </div>
        <div class="col-75">
          <input type="text" id="comp" name="comp" placeholder="Component" value="SV-SMG-SUP-TST"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="cat1_id">Category 1 Id [_cat1_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="cat1_id" name="cat1_id" placeholder="Category 1 Id" value="CIC_3"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="cat1">Category 1 [_cat1]</label>
        </div>
        <div class="col-75">
          <input type="text" id="cat1" name="cat1" placeholder="Category 1" value="Launchpad & Support Portal"> </div>
      </div>

      <h3>Customer & Contact Data</h3>
      <div class="row">
        <div class="col-25">
          <label for="cust_id">Customer Id [_cust_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="cust_id" name="cust_id" placeholder="ERP Customer Id" value="1208936"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="cust">Customer [_cust]</label>
        </div>
        <div class="col-75">
          <input type="text" id="cust" name="cust" placeholder="Customer" value="SAP Test Account - aPaul Pharma"> </div>
      </div>


      <div class="row">
        <div class="col-25">
          <label for="suser_id">S-User Id [_suser_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="suser_id" name="suser_id" placeholder="S-User Id" value="S0008363031">
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="suser">S-User [_suser]</label>
        </div>
        <div class="col-75">
          <input type="text" id="suser" name="suser" placeholder="S-User name" value="Elisabeth Prokesch">
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="var_part_id">VAR Partmer Id [_var_part_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="var_part_id" name="var_part_id" placeholder="VAR Partner Id" value="">
        </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="var_part">VAR Partner [_var_part]</label>
        </div>
        <div class="col-75">
          <input type="text" id="var_part" name="var_part" placeholder="VAR Partner name" value="">
        </div>
      </div>



      <h3>System Data</h3>
      <div class="row">
        <div class="col-25">
          <label for="inst_number">Installation Number [_inst_number]</label>
        </div>
        <div class="col-75">
          <input type="text" id="inst_number" name="inst_number" placeholder="Installation ID" value="0020659001"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="inst">Installation [_inst]</label>
        </div>
        <div class="col-75">
          <input type="text" id="inst" name="inst" placeholder="Installation" value="ERP Standard Legacy App Testname"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="sys_id">System ID [_sys_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="sys_id" name="sys_id" placeholder="System ID" value="AP1"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="sys_name">System Name [_sys_name]</label>
        </div>
        <div class="col-75">
          <input type="text" id="sys_name" name="sys_name" placeholder="System Name" value="Test System Overview Reportã® (LONG_SID_EUDP"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="sys_num">System Number [_sys_num]</label>
        </div>
        <div class="col-75">
          <input type="text" id="sys_num" name="sys_num" placeholder="System Number" value="000000000311656080"> </div>
      </div>


      <h3>Requester Data</h3>
  	<div class="row">
	<div class="col-25">
		<label for="firstname">Firstname [_firstname]</label>
	</div>
	<div class="col-75">
		<input type="text" id="firstname" name="firstname"
			placeholder="Firstname" value="Ronald">
	</div>
	</div>

	<div class="row">
		<div class="col-25">
			<label for="lastname">Lastname [_lastname]</label>
		</div>
		<div class="col-75">
			<input type="text" id="lastname" name="lastname"
				placeholder="Lastname" value="Reagan">
		</div>
	</div>
      
      <div class="row">
        <div class="col-25">
          <label for="company">Company [_company]</label>
        </div>
        <div class="col-75">
          <input type="text" id="company" name="company" placeholder="Company name" value="Mondi Company AG"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="salut_id">Salutation Id [_salut_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="salut_id" name="salut_id" placeholder="Salutation Id" value="0002"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="salut">Salutation [_salut]</label>
        </div>
        <div class="col-75">
          <input type="text" id="salut" name="salut" placeholder="Salutation" value="Mr."> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="city">City [_city]</label>
        </div>
        <div class="col-75">
          <input type="text" id="city" name="city" placeholder="City" value="Washington"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="country_id">Country Id [_country_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="country_id" name="country_id" placeholder="Country Id" value="US"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="country">Country [_country]</label>
        </div>
        <div class="col-75">
          <input type="text" id="country" name="country" placeholder="Country" value="United States of America"> </div>
      </div>

      <div class="row">
        <div class="col-25">
          <label for="comm_id">Communication Method Id [_comm_id]</label>
        </div>
        <div class="col-75">
          <input type="text" id="comm_id" name="comm_id" placeholder="Communication Method Id" value="INT"> </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="comm">Communication Method [_comm]</label>
        </div>
        <div class="col-75">
          <input type="text" id="comm" name="comm" placeholder="Preferred Communication Method" value="Email"> </div>
      </div>
      
      	<div class="row">
		<div class="col-25">
			<label for="relation_id">Relation ID [_relation_id]</label>
		</div>
		<div class="col-75">
			<input type="text" id="relation_id" name="relation_id"
				placeholder="Relation ID" value="10">
		</div>
	</div>

	<div class="row">
		<div class="col-25">
			<label for="relation">Relation [_relation]</label>
		</div>
		<div class="col-75">
			<input type="text" id="relation" name="relation"
				placeholder="Relation" value="Customer">
		</div>
	</div>      
      
	<h3>Links</h3>
	<div class="row">
		<div class="col-25">
			<label for="attach_url">Attach URL [_attach_url]</label>
		</div>
		<div class="col-75">
			<input type="text" id="attach_url" name="attach_url"
				placeholder="Attach URL" value="https://documentswaeb84638.int.sap.hana.ondemand.com/bsr/WSMJha267ZeoRhqo_Yu4iQegA-qRxrV1dcZww7qHoIg">
		</div>
	</div>

	<div class="row">
		<div class="col-25">
			<label for="attach_descr">Attach Descr [_attach_descr]</label>
		</div>
		<div class="col-75">
			<input type="text" id="attach_descr" name="attach_descr"
				placeholder="Attach Descr" value="Doc.Service Attachment Description">
		</div>
	</div>


	<div class="row">
		<div class="col-25">
			<label for="remote_url">Remote URL [_remote_url]</label>
		</div>
		<div class="col-75">
			<input type="text" id="remote_url" name="remote_url"
				placeholder="Remote URL" value="https://bcdmain.wdf.sap.corp/sap/bc/bsp/sap/zsvc_ic_a1s_mf/SrvConlink.sap?installationNo=0120009915&systemNo=000000000800001418">
		</div>
	</div>


      
      <div class="row">
        <input id="submit_button" type="submit" value="Start Chat" disabled>
      </div>
    </form>
  </div>

  <script type="text/javascript">
    var accountId = "134677647614434124";
    var apiKeyId = "135272746091564714";
    var apiKey = "UZDAHE5wvyowxK6FLMsHAtacgmommz61";

    var websiteId = "135208827236928490";
    var floatButtonId = "135280491512603403";

    var urlLocation = location.href;

    var ele = document.getElementById("SAPFORM");
    if (ele.addEventListener) {
      ele.addEventListener("submit", formcallback, false); //Modern browsers
    } else if (ele.attachEvent) {
      ele.attachEvent("onsubmit", formcallback); //Old IE
    }

    function formcallback(evt) {
      if (evt && evt.preventDefault) {
        evt.preventDefault();
      } else if (event) {
        event.returnValue = false;
      }
    }

    var validator = new FormValidator("SAPFORM", [{
        name: "fname",
        rules: "required"
      },
      {
        name: "lname",
        rules: "required"
      },
      {
        name: "phone",
        rules: "numeric|min_length[8]"
      },
      {
        name: "email",
        rules: "required|valid_email"
      },
      {
        name: "department",
        rules: "required"
      }
    ], function (errors, evt) {
      var SELECTOR_ERRORS = document.getElementById("error_box"),
        SELECTOR_SUCCESS = document.getElementById("success_box");
      if (errors.length > 0) {
        SELECTOR_ERRORS.innerHTML = "";
        for (var i = 0, errorLength = errors.length; i < errorLength; i++) {
          SELECTOR_ERRORS.innerHTML += errors[i].message + "<br />";
        }
        SELECTOR_SUCCESS.style.display = "none";
        SELECTOR_ERRORS.style.display = "block";
      } else {
        /*** FORM HAD BEEN VALIDATED ***/
        SELECTOR_SUCCESS.style.display = "block";
        SELECTOR_ERRORS.style.display = "none";
        bc_ChatStart();
      }
    });

    function getData(sPath, sParameters) {
      var auth = accountId + ":" + apiKeyId + ":" + (new Date()).getTime();
      var authHash = auth + ":" + CryptoJS.SHA512(auth + apiKey).toString(CryptoJS.enc.Hex);
      var sLocation = "https://api-eu.boldchat.com/aid/" + accountId + "/data/rest/json/v1/" + sPath + "?auth=" +
        authHash;
      if (sParameters !== undefined && sParameters.length > 0) {
        sLocation += "&" + sParameters;
      }
      return $.ajax({
        type: "GET",
        url: sLocation,
        contentType: "application/json",
        dataType: "jsonp",
        success: function (oData) {
          return oData;
        },
        error: function (oError) {
          console.log("Error: " + oError.message);
          return oError;
        }
      });
    }

    function getAllDepartments() {
      $("<option disabled selected value> -- select an option -- </option>").appendTo("#department");
      getData("getDepartments").then(function (oData) {
        var aResults = oData.Data;
        var aFilterResults = [];
        aResults.filter(function (oItem) {
            return oItem.Name.substring(0, 4) === "TEST";
          })
          .map(function (oItem) {
            $("<option value=" + oItem.DepartmentID + ">" + oItem.Name + "</option>").appendTo("#department");
          });
      });
    }

    function getDepartmentAvailable(sID) {
      var sParameters = "DepartmentID=" + sID;
      return getData("getDepartment", sParameters).then(function (oData) {
        return ((oData.Data.ChatService.Capacity > 0) ||
          (oData.Data.ChatService.Capacity == "unlimited")) ? true : false;
      });
    }

    function bc_ChatStart() {
      var bc_map = {
        "fname": "vn", //standard
        "lname": "ln", //standard
        "phone": "vp", //standard
        "email": "ve", //standard
        "question": "iq", //standard
        "info": "vi",
        "ref": "vr",
        "lang": "lc",
        "url": "url",
        "busunit": "customField__busunit",
        "subject": "customField__subject",
        "comp_id": "customField__comp_id",
        "comp": "customField__comp",
        "cat1_id": "customField__cat1_id",
        "cat1": "customField__cat1",
        "cust_id": "customField__cust_id",
        "cust": "customField__cust",
        "suser_id": "customField__suser_id",
        "suser": "customField__suser",
        "var_part_id": "customField__var_part_id",
        "var_part": "customField__var_part",
        "inst_number": "customField__inst_number",
        "inst": "customField__inst",
        "sys_id": "customField__sys_id",
        "sys_name": "customField__sys_name",
        "sys_num": "customField__sys_num",
        "company": "customField__company",
        "salut_id": "customField__salut_id",
        "salut": "customField__salut",
        "city": "customField__city",
        "country_id": "customField__country_id",
        "country": "customField__country",
        "comm_id": "customField__comm_id",
        "comm": "customField__comm",
		"attach_url" : "customField__attach_url",
		"attach_descr" : "customField__attach_descr",
		"firstname" : "customField__firstname",
		"lastname" : "customField__lastname",
		"remote_url" : "customField__remote_url",
		"relation_id" : "customField__relation_id",
		"relation" : "customField__relation"
      };
      var sDepartment = document.getElementsByName("department")[0];
      if (sDepartment !== null) {
        sDepartmentID = sDepartment.value;
        if (sDepartmentID !== "") {
          getDepartmentAvailable(sDepartmentID).then(function (bOperatorOnline) {
            if (bOperatorOnline) {
              var WP = "";
              for (var property in bc_map) {
                if (bc_map.hasOwnProperty(property)) {
                  var el = document.getElementById(property);
                  if ((el !== null) && (el.value !== "")) {
                    WP += bc_map[property] + "=" + el.value + "&";
                  }
                }
              }
              if (WP.slice(-1) == "&") WP = WP.slice(0, -1);
              _bcvma.push(["setParameter", "WindowParameters", WP]);
              //console.log(WP);
              pageViewer.load();
              document.querySelector(".bcFloat img").click();
            }
          });
        }
      }
    }

      var bc_Refresh = setInterval(function(){
      var b = document.getElementById("submit_button");
      var sDepartment = document.getElementsByName("department")[0];
      if ((b !== null) && (sDepartment !== null)) {
        b.style.display = (document.getElementById("bc-frame") == null) ? "block" : "none";
        sDepartmentID = sDepartment.value;
        if (sDepartmentID !== "") {
          getDepartmentAvailable(sDepartmentID).then(function (bOperatorOnline) {
            b.disabled = bOperatorOnline ? false : true;
          });
        } else b.disabled = true;
      }
    }, 2000);

    window.sDepartmentID = ""; //let's make sure it's declared as Global
    window._bcvma = window._bcvma || [];
    _bcvma.push(["setAccountID", accountId]);
    _bcvma.push(["setParameter", "WebsiteID", websiteId]);
    _bcvma.push(["addFloat", {
      type: "chat",
      id: floatButtonId
    }]);
    _bcvma.push(["pageViewed"]);

    var bcLoad = function () {
      if (window.bcLoaded) return;
      window.bcLoaded = true;
      var vms = document.createElement("script");
      vms.type = "text/javascript";
      vms.async = true;
      vms.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + "vmss-eu.boldchat.com/aid/" +
        accountId + "/bc.vms4/vms.js";
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(vms, s);
    };
    if (window.pageViewer && pageViewer.load) pageViewer.load();
    else if (document.readyState == "complete") bcLoad();
    else if (window.addEventListener) window.addEventListener('load', bcLoad, false);
    else window.attachEvent('onload', bcLoad);

    getAllDepartments();
    
  </script>
</body>

</html>